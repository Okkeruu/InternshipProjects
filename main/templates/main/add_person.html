{% load static %}
<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <title>ÎÎ­Î± Î•Î¹ÏƒÎ±Î³Ï‰Î³Î®</title>

<style>

/* Container under the input */
#title-suggestions {
    border: 1px solid #ccc;
    max-height: 200px;
    overflow: auto;
    width: 100%;
    background-color: white;
    position: absolute; /* allows it to float over the form */
    z-index: 1000;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    padding: 0;
    margin: 0;
}

/* Individual suggestion boxes */
.suggestion-item {
    padding: 8px 12px;
    cursor: pointer;
    border-bottom: 1px solid #eee;
}

.suggestion-item:hover {
    background-color: #f0f0f0;
}


#ekdoths-suggestions {
    border: 1px solid #ccc;
    max-height: 200px;
    overflow: auto;
    width: 100%;
    background-color: white;
    position: absolute; /* allows it to float over the form */
    z-index: 1000;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    padding: 0;
    margin: 0;
}

/* Individual suggestion boxes */
.suggestion-item {
    padding: 8px 12px;
    cursor: pointer;
    border-bottom: 1px solid #eee;
}

.suggestion-item:hover {
    background-color: #f0f0f0;
}




* {
    box-sizing: border-box;
}

body {
    background: #f4f7fb;
    font-family: "Segoe UI", sans-serif;
    margin: 0;
    padding: 0;
}

.page-wrapper {
    max-width: 1400px;
    margin: 30px auto;
    padding: 25px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
}

h1 {
    margin-bottom: 25px;
    color: #1f3c88;
}

form {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 16px;
    width: 100%;
}

.field-box {
    position: relative;
    background: #e8f0ff;
    padding: 10px;
    border-radius: 8px;
    border-left: 4px solid #1f3c88;
}

.field-box label {
    display: block;
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 5px;
    color: #1f3c88;
}

input,
textarea,
select {
    width: 100%;
    padding: 6px 8px;
    border-radius: 5px;
    border: 1px solid #c6d4ff;
    font-size: 14px;
    background: #fff;
}

input[readonly] {
    background: #dde6ff;
    font-weight: bold;
}

/* textarea Î¼Î¹ÎºÏÏŒ Î±ÏÏ‡Î¹ÎºÎ¬ â€“ Î¼ÎµÎ³Î±Î»ÏÎ½ÎµÎ¹ Ï€ÏÎ¿Ï‚ Ï„Î± ÎºÎ¬Ï„Ï‰ */
textarea {
    resize: none;
    overflow: auto;
    min-height: 28px;
    line-height: 1.3;
}

/* ÎšÎŸÎ¥ÎœÎ Î™Î‘ */
.submit-wrapper {
    grid-column: 1 / -1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 24px;
    margin-top: 25px;
    flex-wrap: wrap;
}

button {
    background: #1f3c88;
    color: white;
    border: none;
    padding: 11px 30px;
    font-size: 15px;
    font-weight: 600;
    border-radius: 6px;
    cursor: pointer;
}

button:hover {
    background: #162c63;
}

.btn-secondary {
    background: #2d6cdf;
    color: white;
    text-decoration: none;
    padding: 11px 30px;
    border-radius: 6px;
    font-size: 15px;
    font-weight: 600;
}

.btn-secondary:hover {
    background: #1f56b3;
}

/* ÎœÎ—ÎÎ¥ÎœÎ‘ Î¥Î ÎŸÎ’ÎŸÎ›Î—Î£ */
.submit-msg {
    font-size: 14px;
    color: #1f3c88;
    font-weight: 600;
}
</style>
</head>

<body>

{% if submitted %}
<div style="background: #d4edda; padding: 15px; margin-bottom: 20px; border-radius: 5px; border-left: 4px solid #28a745;">
    {% if all_complete %}
        <strong>ğŸ‰ Success!</strong><br>
        Record saved successfully! All incomplete records have been completed.
        <br><br>
        <a href="{% url 'incomplete_records' %}" style="color: #155724; text-decoration: underline;">
            â† Back to Incomplete Records
        </a>
    {% elif is_editing %}
        <strong>âœ… Record Updated!</strong><br>
        Previous record saved. Fill in the details below for the next incomplete record.
    {% else %}
        <strong>âœ… Success!</strong><br>
        Record added successfully!
    {% endif %}
</div>
{% endif %}

{% if is_editing %}
<div style="margin-bottom: 20px;">
    <a href="{% url 'incomplete_records' %}" 
       style="background: #6c757d; color: white; padding: 8px 16px; text-decoration: none; border-radius: 5px; display: inline-block;">
        â† Back to Incomplete Records List
    </a>
</div>
{% endif %}


{% if is_editing and not submitted %}
<div style="background: #fff3cd; padding: 15px; margin-bottom: 20px; border-radius: 5px; border-left: 4px solid #ffc107;">
    <strong>âš ï¸ Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± ÎµÎ»ÎµÎ¹Ï€Î® Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½</strong><br>
    Î£Ï…Î¼Ï€Î»Î·ÏÏÎ½ÎµÏ„Îµ Ï„Î± ÎµÎ»Î»Î¹Ï€Î® Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î³Î¹Î± Ï„Î·Î½ ÎµÎ³Î³ÏÎ±Ï†Î® #{{ next_number }}
</div>
{% endif %}

<div class="page-wrapper">
    <h1>ÎÎ­Î± Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® Î’Î¹Î²Î»Î¯Î¿Ï…</h1>

    <form method="post">
        {% csrf_token %}

        <div class="field-box">
            <label>Î‘Î¡Î™Î˜ÎœÎŸÎ£ Î•Î™Î£Î‘Î“Î©Î“Î—Î£</label>
            <input type="text" value="{{ next_number }}" readonly>
        </div>

        <div class="field-box">
            <label>Î—ÎœÎ•Î¡ÎŸÎœÎ—ÎÎ™Î‘ Î•Î™Î£Î‘Î“Î©Î“Î—Î£</label>
            {{ form.hmeromhnia_eis }}
        </div>

        <div class="field-box">
            <label>Î£Î¥Î“Î“Î¡Î‘Î¦Î•Î‘Î£</label>
            {{ form.syggrafeas }}
        </div>

        <div class="field-box">
            <label>Î£Î¥Î“Î“Î¡Î‘Î¦Î•Î‘Î£ KOHA</label>
            {{ form.koha }}
        </div>

        <div class="field-box">
            <label>Î¤Î™Î¤Î›ÎŸÎ£</label>
            {{ form.titlos }}
            <div id="title-suggestions" class="autocomplete-box"></div>
            
        </div>

        

        <div class="field-box">
            <label>Î•ÎšÎ”ÎŸÎ¤Î—Î£</label>
            {{ form.ekdoths }}
            <div id="ekdoths-suggestions" class="autocomplete-box"></div>
        </div>

        <div class="field-box">
            <label>Î•ÎšÎ”ÎŸÎ£Î—</label>
            {{ form.ekdosh }}
        </div>

        <div class="field-box">
            <label>Î•Î¤ÎŸÎ£ Î•ÎšÎ”ÎŸÎ£Î—Î£</label>
            {{ form.etosEkdoshs }}
        </div>

        <div class="field-box">
            <label>Î¤ÎŸÎ ÎŸÎ£ Î•ÎšÎ”ÎŸÎ£Î—Î£</label>
            {{ form.toposEkdoshs }}
        </div>

        <div class="field-box">
            <label>Î£Î§Î—ÎœÎ‘</label>
            {{ form.sxhma }}
        </div>

        <div class="field-box">
            <label>Î£Î•Î›Î™Î”Î•Î£</label>
            {{ form.selides }}
        </div>

        <div class="field-box">
            <label>Î¤ÎŸÎœÎŸÎ£</label>
            {{ form.tomos }}
        </div>

        <div class="field-box">
            <label>Î¤Î¡ÎŸÎ ÎŸÎ£ Î Î¡ÎŸÎœÎ—Î˜Î•Î™Î‘Î£ / Î Î‘Î¡Î‘Î¤Î—Î¡Î—Î£Î•Î™Î£</label>
            {{ form.troposPromPar }}
        </div>

        <div class="field-box">
            <label>ISBN</label>
            {{ form.ISBN }}
        </div>

        <div class="field-box">
            <label>Î£Î¤Î—Î›Î— 1</label>
            {{ form.sthlh1 }}
        </div>

        <div class="field-box">
            <label>Î£Î¤Î—Î›Î— 2</label>
            {{ form.sthlh2 }}
        </div>

        <div class="submit-wrapper">
            <a href="{% url 'home' %}" class="btn-secondary">Î‘ÏÏ‡Î¹ÎºÎ®</a>
            <button type="submit" onclick="return confirmSubmit();">Î¥Ï€Î¿Î²Î¿Î»Î®</button>


            {% if request.GET.submitted == "1" %}
                
            <span class="submit-msg" id="submit-msg">Î¥Ï€Î¿Î²Î»Î®Î¸Î·ÎºÎµ</span>
            {% endif %}
        </div>
    </form>
</div>

<script>
function confirmSubmit() {
    return confirm("Î•Î¯ÏƒÎ±Î¹ ÏƒÎ¯Î³Î¿Ï…ÏÎ¿Ï‚ Î³Î¹Î± Î±Ï…Ï„Î®Î½ Ï„Î·Î½ Ï…Ï€Î¿Î²Î¿Î»Î®?");
}
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'main/autocomplete.js' %}"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {

    document.querySelectorAll("textarea").forEach(el => {
        el.addEventListener("input", function () {
            this.style.height = "auto";
            this.style.height = this.scrollHeight + "px";
        });
    });

    const msg = document.getElementById("submit-msg");
    if (msg) {
        setTimeout(() => {
            msg.style.display = "none";

            // ğŸ”¥ ÎšÎ‘Î˜Î‘Î¡Î™Î–Î•Î™ Î¤ÎŸ URL Î“Î™Î‘ Î Î‘ÎÎ¤Î‘
            window.history.replaceState(
                {},
                document.title,
                window.location.pathname
            );

        }, 3000);
    }
});
</script>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const authorInput = document.getElementById("id_syggrafeas");
    const kohaInput = document.getElementById("id_koha");

    if (!authorInput || !kohaInput) return;

    authorInput.addEventListener("blur", function () {
        let value = this.value.trim();

        // Expected format: surname,name
        if (!value.includes(",")) return;

        let parts = value.split(",");

        if (parts.length !== 2) return;

        let surname = parts[0].trim();
        let name = parts[1].trim();

        if (!surname || !name) return;

        // Autofill KOHA as "name surname"
        kohaInput.value = `${name} ${surname}`;
    });
});
</script>


</body>
</html>
