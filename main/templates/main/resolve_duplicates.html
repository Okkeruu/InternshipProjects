{% extends "base.html" %}
{% block title %}Î•Ï€Î¯Î»Ï…ÏƒÎ· Î”Î¹Ï€Î»ÏŒÏ„Ï…Ï€Ï‰Î½{% endblock %}

{% block content %}

<style>
/* ====== LAYOUT ====== */
.page-wrapper {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

.page-title {
    text-align: center;
    margin-bottom: 30px;
}

/* ====== INFO BOXES ====== */
.info-box,
.insertion-box {
    max-width: 900px;
    margin: 20px auto;
    padding: 15px 20px;
    border-radius: 8px;
    text-align: center;
}

.info-box {
    background: #fff3cd;
    border-left: 5px solid #ffc107;
}

.insertion-box {
    background: #e6f4ea;
    border-left: 5px solid #28a745;
}

/* ====== ACTIONS ====== */
.action-buttons {
    text-align: center;
    margin: 30px 0;
}

.btn {
    padding: 12px 22px;
    margin: 8px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 15px;
    font-weight: bold;
}

.btn-replace { background:#28a745; color:#fff; }
.btn-skip { background:#dc3545; color:#fff; }
.btn-home { background:#17a2b8; color:#fff; }
.btn-select-all { background:#f0ad4e; color:#fff; }

.btn:hover { opacity:0.9; }

/* ====== CARDS ====== */
.card {
    background: #ffffff;
    border-radius: 10px;
    padding: 25px;
    margin: 40px 0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

/* ====== TABLES ====== */
.table-wrapper {
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin: 15px 0;
}

th, td {
    border: 1px solid #ddd;
    padding: 8px;
    font-size: 14px;
}

th {
    text-align: center;
    color: #fff;
}

.excel-table th { background:#1f3c88; }
.database-table th { background:#8a1f1f; }
.insertion-table th { background:#2d7a2d; }

/* ====== SELECTORS ====== */
.record-selector {
    text-align: center;
    margin-bottom: 15px;
}

.record-selector input {
    transform: scale(1.4);
    margin-right: 8px;
}
</style>

<div class="page-wrapper">

<h2 class="page-title">ğŸ“‘ Î•Ï€Î¯Î»Ï…ÏƒÎ· Î”Î¹Ï€Î»ÏŒÏ„Ï…Ï€Ï‰Î½ & ÎšÎµÎ½ÏÎ½ Î•Î³Î³ÏÎ±Ï†ÏÎ½</h2>

{% if duplicate_count > 0 %}
<div class="info-box">
    <strong>âš ï¸ Î’ÏÎ­Î¸Î·ÎºÎ±Î½ {{ duplicate_count }} Î´Î¹Ï€Î»ÏŒÏ„Ï…Ï€ÎµÏ‚ ÎµÎ³Î³ÏÎ±Ï†Î­Ï‚</strong><br>
    Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï€Î¿Î¹ÎµÏ‚ Î¸Î± Î±Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î±Î¸Î¿ÏÎ½ Î±Ï€ÏŒ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Excel.
</div>
{% endif %}

{% if insertion_count > 0 %}
<div class="insertion-box">
    <strong>âœ¨ {{ insertion_count }} ÎºÎµÎ½Î­Ï‚ ÎµÎ³Î³ÏÎ±Ï†Î­Ï‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÏƒÏ…Î¼Ï€Î»Î·ÏÏ‰Î¸Î¿ÏÎ½</strong>
</div>
{% endif %}

<form method="post" action="{% url 'replace_all_duplicates' %}">
{% csrf_token %}

<div class="action-buttons">
    <button type="button" class="btn btn-select-all" onclick="selectAllDuplicates()">â˜‘ï¸ ÎŒÎ»Î± Ï„Î± Î”Î¹Ï€Î»ÏŒÏ„Ï…Ï€Î±</button>
    <button type="button" class="btn btn-select-all" onclick="selectAllInsertions()">â˜‘ï¸ ÎŒÎ»ÎµÏ‚ Î¿Î¹ ÎšÎµÎ½Î­Ï‚</button>

    <button type="submit" class="btn btn-replace"
        onclick="return confirm('Î— ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Î´ÎµÎ½ Î±Î½Î±Î¹ÏÎµÎ¯Ï„Î±Î¹. Î£Ï…Î½Î­Ï‡ÎµÎ¹Î±;')">
        âœ… Î‘Î½Ï„Î¹ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·
    </button>

    <button type="button" class="btn btn-skip" onclick="document.getElementById('skipForm').submit();">
        â­ï¸ Î Î±ÏÎ¬Î»ÎµÎ¹ÏˆÎ·
    </button>

    <a href="{% url 'home' %}">
        <button type="button" class="btn btn-home">ğŸ  Î‘ÏÏ‡Î¹ÎºÎ®</button>
    </a>
</div>

{% if duplicates %}
{% for dup in duplicates %}
<div class="card">

<div class="record-selector">
    <input type="checkbox" name="duplicate_ids[]" value="{{ dup.left.ari8mos }}" class="duplicate-checkbox">
    <strong>Î‘Î½Ï„Î¹ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚</strong>
</div>

<h3>Î”Î¹Ï€Î»ÏŒÏ„Ï…Ï€Î¿ #{{ forloop.counter }} â€” Î‘Ï. Î•Î¹ÏƒÎ±Î³Ï‰Î³Î®Ï‚ {{ dup.left.ari8mos }}</h3>

<div class="table-wrapper">
<table class="excel-table">
<thead><tr><th colspan="14">Excel (ÎÎ­Î± Î”ÎµÎ´Î¿Î¼Î­Î½Î±)</th></tr></thead>
<tbody><tr>
<td>{{ dup.right.ari8mos }}</td>
<td>{{ dup.right.hmeromhnia_eis|default:"-" }}</td>
<td>{{ dup.right.syggrafeas|default:"-" }}</td>
<td>{{ dup.right.koha|default:"-" }}</td>
<td>{{ dup.right.titlos|default:"-" }}</td>
<td>{{ dup.right.ekdoths|default:"-" }}</td>
<td>{{ dup.right.ekdosh|default:"-" }}</td>
<td>{{ dup.right.etosEkdoshs|default:"-" }}</td>
<td>{{ dup.right.toposEkdoshs|default:"-" }}</td>
<td>{{ dup.right.sxhma|default:"-" }}</td>
<td>{{ dup.right.selides|default:"-" }}</td>
<td>{{ dup.right.tomos|default:"-" }}</td>
<td>{{ dup.right.troposPromPar|default:"-" }}</td>
<td>{{ dup.right.ISBN|default:"-" }}</td>
</tr></tbody>
</table>
</div>

<div class="table-wrapper">
<table class="database-table">
<thead><tr><th colspan="14">Database (Î¥Ï€Î¬ÏÏ‡Î¿Î½Ï„Î±)</th></tr></thead>
<tbody><tr>
<td>{{ dup.left.ari8mos }}</td>
<td>{{ dup.left.hmeromhnia_eis|default:"-" }}</td>
<td>{{ dup.left.syggrafeas|default:"-" }}</td>
<td>{{ dup.left.koha|default:"-" }}</td>
<td>{{ dup.left.titlos|default:"-" }}</td>
<td>{{ dup.left.ekdoths|default:"-" }}</td>
<td>{{ dup.left.ekdosh|default:"-" }}</td>
<td>{{ dup.left.etosEkdoshs|default:"-" }}</td>
<td>{{ dup.left.toposEkdoshs|default:"-" }}</td>
<td>{{ dup.left.sxhma|default:"-" }}</td>
<td>{{ dup.left.selides|default:"-" }}</td>
<td>{{ dup.left.tomos|default:"-" }}</td>
<td>{{ dup.left.troposPromPar|default:"-" }}</td>
<td>{{ dup.left.ISBN|default:"-" }}</td>
</tr></tbody>
</table>
</div>

</div>
{% endfor %}
{% endif %}

 <!-- ============================= -->
    <!--   Î›Î™Î£Î¤Î‘ POTENTIAL INSERTIONS -->
    <!-- ============================= -->

    {% if potential_insertions %}
    <h2 style="color:#2d7a2d;">âœ¨ ÎšÎµÎ½Î­Ï‚ Î•Î³Î³ÏÎ±Ï†Î­Ï‚ Î³Î¹Î± Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎ· ({{ insertion_count }})</h2>

    {% for insertion in potential_insertions %}

    <div class="record-selector">
        <input type="checkbox" 
               name="insertion_ids[]" 
               value="{{ insertion.ari8mos }}"
               id="ins_{{ insertion.ari8mos }}"
               class="insertion-checkbox">
        <label for="ins_{{ insertion.ari8mos }}">
            <strong>Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎ· Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ ÎºÎµÎ½Î®Ï‚ ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚ Î¼Îµ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î±Ï€ÏŒ Ï„Î¿ Excel</strong>
        </label>
    </div>

    <h3 style="margin-top:30px; color:#2d7a2d;">ÎšÎµÎ½Î® Î•Î³Î³ÏÎ±Ï†Î® #{{ forloop.counter }} - Î‘Ï. Î•Î¹ÏƒÎ±Î³Ï‰Î³Î®Ï‚: {{ insertion.ari8mos }}</h3>

    <!-- DATABASE (EMPTY) -->
    <h4 style="color:#8a1f1f;">Database Data (ÎšÎµÎ½Î® Î•Î³Î³ÏÎ±Ï†Î®)</h4>
    <table class="database-table">
        <thead>
            <tr>
                <th>Î‘Ï. Î•Î¹ÏƒÎ±Î³Ï‰Î³Î®Ï‚</th>
                <th>Î—Î¼/Î½Î¯Î± Î•Î¹ÏƒÎ±Î³Ï‰Î³Î®Ï‚</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{{ insertion.database.ari8mos }}</td>
                <td>{{ insertion.database.hmeromhnia_eis|default:"-" }}</td>
            </tr>
        </tbody>
    </table>

    <!-- EXCEL (NEW DATA) -->
    <h4 style="color:#2d7a2d;">Excel Data (ÎÎ­Î± Î”ÎµÎ´Î¿Î¼Î­Î½Î± Î³Î¹Î± Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎ·)</h4>
    <table class="insertion-table">
        <thead>
            <tr>
                <th>Î‘Ï. Î•Î¹ÏƒÎ±Î³Ï‰Î³Î®Ï‚</th>
                <th>Î—Î¼/Î½Î¯Î± Î•Î¹ÏƒÎ±Î³Ï‰Î³Î®Ï‚</th>
                <th>Î£Ï…Î³Î³ÏÎ±Ï†Î­Î±Ï‚</th>
                <th>KOHA</th>
                <th>Î¤Î¯Ï„Î»Î¿Ï‚</th>
                <th>Î•ÎºÎ´ÏŒÏ„Î·Ï‚</th>
                <th>ÎˆÎºÎ´Î¿ÏƒÎ·</th>
                <th>ÎˆÏ„Î¿Ï‚ ÎˆÎºÎ´Î¿ÏƒÎ·Ï‚</th>
                <th>Î¤ÏŒÏ€Î¿Ï‚ ÎˆÎºÎ´Î¿ÏƒÎ·Ï‚</th>
                <th>Î£Ï‡Î®Î¼Î±</th>
                <th>Î£ÎµÎ»Î¯Î´ÎµÏ‚</th>
                <th>Î¤ÏŒÎ¼Î¿Ï‚</th>
                <th>Î¤ÏÏŒÏ€Î¿Ï‚ Î ÏÎ¿Î¼Î®Î¸ÎµÎ¹Î±Ï‚</th>
                <th>ISBN</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{{ insertion.excel.ari8mos }}</td>
                <td>{{ insertion.excel.hmeromhnia_eis|default:"-" }}</td>
                <td>{{ insertion.excel.syggrafeas|default:"-" }}</td>
                <td>{{ insertion.excel.koha|default:"-" }}</td>
                <td>{{ insertion.excel.titlos|default:"-" }}</td>
                <td>{{ insertion.excel.ekdoths|default:"-" }}</td>
                <td>{{ insertion.excel.ekdosh|default:"-" }}</td>
                <td>{{ insertion.excel.etosEkdoshs|default:"-" }}</td>
                <td>{{ insertion.excel.toposEkdoshs|default:"-" }}</td>
                <td>{{ insertion.excel.sxhma|default:"-" }}</td>
                <td>{{ insertion.excel.selides|default:"-" }}</td>
                <td>{{ insertion.excel.tomos|default:"-" }}</td>
                <td>{{ insertion.excel.troposPromPar|default:"-" }}</td>
                <td>{{ insertion.excel.ISBN|default:"-" }}</td>
            </tr>
        </tbody>
    </table>

    <hr style="margin:40px 0; border:1px solid #ccc;">

    {% endfor %}
    {% endif %}



</form>

<!-- Separate form for skip action -->
<form method="post" action="{% url 'skip_all_duplicates' %}" id="skipForm" style="display:none;">
{% csrf_token %}
</form>

</div>



<script>
function selectAllDuplicates() {
    const checkboxes = document.querySelectorAll('.duplicate-checkbox');
    const allChecked = Array.from(checkboxes).every(cb => cb.checked);
    checkboxes.forEach(cb => cb.checked = !allChecked);
}

function selectAllInsertions() {
    const checkboxes = document.querySelectorAll('.insertion-checkbox');
    const allChecked = Array.from(checkboxes).every(cb => cb.checked);
    checkboxes.forEach(cb => cb.checked = !allChecked);
}
</script>

{% endblock %}
